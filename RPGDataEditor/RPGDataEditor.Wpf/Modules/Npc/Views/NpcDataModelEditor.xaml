<UserControl x:Class="RPGDataEditor.Wpf.Npc.Views.NpcDataModelEditor"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             mc:Ignorable="d"
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
             xmlns:converters="clr-namespace:RPGDataEditor.Wpf.Converters"
             xmlns:models="clr-namespace:RPGDataEditor.Core.Models;assembly=RPGDataEditor.Core"
             xmlns:controls="clr-namespace:RPGDataEditor.Wpf.Controls"
             Style="{DynamicResource DefaultEditorControl}"
             x:Name="ThisNpcView">
    <StackPanel Margin="10">
        <controls:AutoGeneratedControl PropertyContext="{Binding Model}"
                                       PropertyName="Name" />
        <controls:AutoGeneratedControl PropertyContext="{Binding Model}"
                                       PropertyName="Title" />
        <controls:AutoGeneratedControl PropertyContext="{Binding Model}"
                                       PropertyName="TextureLocation" />
        <materialDesign:Card HorizontalContentAlignment="Center"
                             Margin="5"
                             Padding="5">
            <StackPanel>
                <TextBlock Text="Spawn location" />
                <controls:AutoGeneratedControl PropertyContext="{Binding Model}"
                                               PropertyName="Position" />
            </StackPanel>
        </materialDesign:Card>
        <controls:AutoGeneratedControl PropertyContext="{Binding Model}"
                                       PropertyName="Invulnerable" />
        <controls:AutoGeneratedControl PropertyContext="{Binding Model}"
                                       PropertyName="LookAtPlayer" />
        <controls:ListDataCard x:Name="MovementListDataCard"
                               DataContext="{Binding Model}"
                               AddItemCommand="{Binding DataContext.AddPathCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                               ItemsSource="{Binding Paths}"
                               NoExpandableVisibility="False"
                               IsExpandable="{Binding IsReadOnly,ElementName=MovementListDataCard, Converter={StaticResource BoolToInvertBoolConverter}}"
                               IsReadOnly="{Binding MovementType, Converter={StaticResource InvertStringToBoolConverter}, ConverterParameter='PATH'}">
            <controls:ListDataCard.HeaderTemplate>
                <DataTemplate>
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>
                        <TextBlock Text="{Binding ItemsSource.Count, ElementName=PathListView, StringFormat='({0})'}"
                                   VerticalAlignment="Bottom"
                                   Margin="5,2,2,5" />
                        <ComboBox x:Name="MovementTypeComboBox"
                                  Grid.Column="1"
                                  Margin="10,-2,0,0"
                                  DataContext="{Binding DataContext, RelativeSource={RelativeSource AncestorType=controls:ListDataCard}}"
                                  SelectedItem="{Binding MovementType}"
                                  materialDesign:HintAssist.Hint="Movement Type"
                                  ItemsSource="{Binding Source={converters:EnumBindingSource {x:Type models:NpcMovement}}}"
                                  Style="{DynamicResource MaterialDesignFloatingHintComboBox}" />
                    </Grid>
                </DataTemplate>
            </controls:ListDataCard.HeaderTemplate>
            <DataTemplate>
                <controls:BlockPosField Position="{Binding .}" />
            </DataTemplate>
        </controls:ListDataCard>
        <materialDesign:Card x:Name="ExpandableJobSection"
                             HorizontalContentAlignment="Center"
                             Margin="5"
                             Padding="5">
            <StackPanel>
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>
                    <controls:ExpandButton HorizontalAlignment="Left"
                                           IsEnabled="{Binding SelectedIndex, ElementName=JobComboBox, Mode=OneWay, Converter={StaticResource InvertStringToBoolConverter}, ConverterParameter=0}"
                                           ExpandableElement="{x:Reference JobStackPanel}" />
                    <ComboBox x:Name="JobComboBox"
                              Grid.Column="1"
                              Margin="10,-2,0,0"
                              DataContext="{Binding Model}"
                              DataContextChanged="JobComboBox_DataContextChanged"
                              SelectionChanged="JobComboBox_SelectionChanged"
                              materialDesign:HintAssist.Hint="Job Type"
                              Style="{DynamicResource MaterialDesignFloatingHintComboBox}">
                        <ComboBoxItem Name="NONE"
                                      Content="NONE" />
                        <ComboBoxItem Name="GUARD"
                                      Content="GUARD" />
                        <ComboBoxItem Name="TRADER"
                                      Content="TRADER" />
                    </ComboBox>
                </Grid>
                <StackPanel x:Name="JobStackPanel"
                            Visibility="Collapsed">
                    <StackPanel x:Name="GuardStackPanel"
                                Visibility="Collapsed" />
                    <StackPanel x:Name="TraderStackPanel"
                                Visibility="Collapsed">
                        <controls:ListDataCard x:Name="TradeItemsListCard"
                                               DataContext="{Binding Model.Job}"
                                               ItemsSource="{Binding Items}"
                                               HeaderText="{Binding Items.Count, StringFormat='({0}) Items'}"
                                               AddItemCommand="{Binding DataContext.AddTradeItemCommand, RelativeSource={RelativeSource AncestorType=StackPanel}}">
                            <DataTemplate>
                                <materialDesign:Card Margin="5"
                                                     Padding="5">
                                    <StackPanel>
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto" />
                                                <ColumnDefinition Width="*" />
                                            </Grid.ColumnDefinitions>
                                            <controls:ExpandButton Margin="3,0,3,5"
                                                                   HorizontalAlignment="Left"
                                                                   VerticalAlignment="Bottom"
                                                                   ExpandableElement="{x:Reference TradeItemPanel}" />
                                            <TextBlock Text="{Binding Item}"
                                                       Grid.Column="2"
                                                       VerticalAlignment="Bottom"
                                                       Margin="5,2,2,5" />
                                        </Grid>
                                        <StackPanel x:Name="TradeItemPanel"
                                                    Visibility="Collapsed">
                                            <controls:AutoGeneratedControl PropertyName="Item" />
                                            <controls:AutoGeneratedControl PropertyName="Buy" />
                                            <controls:AutoGeneratedControl PropertyName="Sell" />
                                            <controls:AutoGeneratedControl PropertyName="Count" />
                                            <controls:AutoGeneratedControl PropertyName="Nbt" />
                                        </StackPanel>
                                    </StackPanel>
                                </materialDesign:Card>
                            </DataTemplate>
                        </controls:ListDataCard>
                    </StackPanel>
                </StackPanel>
            </StackPanel>
        </materialDesign:Card>
        <controls:ExpandableCard HeaderText="Attributes">
            <StackPanel>
                <controls:AutoGeneratedControl DataContext="{Binding Model}"
                                               PropertyName="HealthRegen" />
                <controls:AutoGeneratedControl PropertyName="MaxHealth" />
                <controls:AutoGeneratedControl PropertyName="RespawnTime" />
                <controls:AutoGeneratedControl PropertyName="MovementSpeed" />
                <controls:AutoGeneratedControl PropertyName="AttackDamage" />
                <controls:AutoGeneratedControl PropertyName="AttackKnockback" />
                <controls:AutoGeneratedControl PropertyName="AttackSpeed" />
                <controls:AutoGeneratedControl PropertyName="Armor" />
                <controls:AutoGeneratedControl PropertyName="ArmorToughness" />
                <controls:AutoGeneratedControl PropertyName="KnockbackResistance" />
            </StackPanel>
        </controls:ExpandableCard>
        <controls:ExpandableCard DataContext="{Binding Model}"
                                 HeaderText="Equipment">
            <StackPanel x:Name="EquipmentPanel"
                        DataContext="{Binding Equipment}">
                <controls:AutoGeneratedControl PropertyName="MainHand" />
                <controls:AutoGeneratedControl PropertyName="OffHand" />
                <controls:AutoGeneratedControl PropertyName="Head" />
                <controls:AutoGeneratedControl PropertyName="Chest" />
                <controls:AutoGeneratedControl PropertyName="Legs" />
                <controls:AutoGeneratedControl PropertyName="Feet" />
            </StackPanel>
        </controls:ExpandableCard>
        <controls:ExpandableCard HeaderText="Dialogues">
            <StackPanel x:Name="ListsPanel"
                        DataContext="{Binding Model}"
                        Tag="{Binding DataContext.AddTalkLineCommand, RelativeSource={RelativeSource AncestorType=UserControl}}">
                <StackPanel.Resources>
                    <DataTemplate x:Key="TalkLineTemplate">
                        <StackPanel Orientation="Horizontal">
                            <controls:AutoGeneratedControl PropertyName="Text" />
                            <controls:AutoGeneratedControl PropertyName="SoundLocation" />
                        </StackPanel>
                    </DataTemplate>
                    <Style TargetType="{x:Type controls:ListDataCard}"
                           BasedOn="{StaticResource {x:Type controls:ListDataCard}}"
                           x:Key="TalkLineListStyle">
                        <Setter Property="DataContext"
                                Value="{Binding TalkData}" />
                        <Setter Property="AddItemCommand"
                                Value="{Binding Tag, ElementName=ListsPanel}" />
                        <Setter Property="ItemContentTemplate"
                                Value="{StaticResource TalkLineTemplate}" />
                    </Style>
                </StackPanel.Resources>
                <controls:AutoGeneratedControl PropertyContext="{Binding TalkData}"
                                               PropertyName="TalkRange" />
                <controls:ListDataCard ItemsSource="{Binding InteractLines}"
                                       HeaderText="{Binding InteractLines.Count, StringFormat='({0}) Interact Lines'}"
                                       AddItemCommandParameter="{Binding InteractLines}"
                                       Style="{StaticResource TalkLineListStyle}" />
                <controls:ListDataCard ItemsSource="{Binding DeathLines}"
                                       HeaderText="{Binding DeathLines.Count, StringFormat='({0}) Death Lines'}"
                                       AddItemCommandParameter="{Binding DeathLines}"
                                       Style="{StaticResource TalkLineListStyle}" />
                <controls:ListDataCard ItemsSource="{Binding HurtLines}"
                                       HeaderText="{Binding HurtLines.Count, StringFormat='({0}) Hurt Lines'}"
                                       AddItemCommandParameter="{Binding HurtLines}"
                                       Style="{StaticResource TalkLineListStyle}" />
                <controls:ListDataCard DataContext="{Binding TalkData}"
                                       ItemsSource="{Binding InitationDialogues}"
                                       HeaderText="{Binding InitationDialogues.Count, StringFormat='({0}) Initation Dialogues'}"
                                       AddItemCommand="{Binding DataContext.AddDialogueIdCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                       AddItemCommandParameter="{Binding InitationDialogues}">
                    <DataTemplate>
                        <controls:ResourcePicker VerticalAlignment="Center"
                                                 Resource="Dialogue"
                                                 EmptyText="Select initaition dialogue"
                                                 PickedId="{Binding .}" />
                    </DataTemplate>
                </controls:ListDataCard>
            </StackPanel>
        </controls:ExpandableCard>
        <controls:ExpandableCard HeaderText="Living sound locations">
            <StackPanel DataContext="{Binding Model}">
                <controls:AutoGeneratedControl PropertyName="DeathSoundLocation" />
                <controls:AutoGeneratedControl PropertyName="HurtSoundLocation" />
                <controls:AutoGeneratedControl PropertyName="AmbientSoundLocation" />
            </StackPanel>
        </controls:ExpandableCard>
    </StackPanel>
</UserControl>
